@model IdentityService.Web.ViewModels.LdapSyncViewModel
@{
    ViewData["Title"] = "LDAP Sync";
}

<div class="page-header">
    <div>
        <h1 class="page-title">LDAP Synchronization</h1>
        <p class="page-description">Import users from Active Directory</p>
    </div>
    <a asp-action="Configure" class="btn btn-secondary">
        <i class="bi bi-gear"></i> Configure
    </a>
</div>

@if (!string.IsNullOrEmpty(Model.Message))
{
    var isError = Model.Message.Contains("Error") || Model.Message.Contains("failed");
    <div class="alert @(isError ? "alert-danger" : "alert-success") mb-4">
        <i class="bi @(isError ? "bi-exclamation-circle" : "bi-check-circle")"></i>
        <span>@Model.Message</span>
    </div>
}

<div class="row g-4">
    <!-- Sync Status -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Sync Status</h5>
            </div>
            <div class="card-body">
                <div class="stat-card mb-4" style="border: none; padding: 0;">
                    <div class="stat-label">Users Found</div>
                    <div class="stat-value">@Model.Users.Count</div>
                </div>
                
                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="text-muted text-xs mb-1">New</div>
                        <div class="font-semibold" style="color: var(--success);">@Model.NewUsersCount</div>
                    </div>
                    <div class="col-6">
                        <div class="text-muted text-xs mb-1">Existing</div>
                        <div class="font-semibold">@Model.ExistingUsersCount</div>
                    </div>
                </div>
                
                <form method="post" asp-action="Sync">
                    <button type="submit" class="btn btn-primary w-100" @(Model.Users.Count == 0 ? "disabled" : "")>
                        <i class="bi bi-arrow-repeat"></i> Sync Now
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Preview -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Preview</h5>
                <span class="text-muted text-sm">@Model.Users.Count users</span>
            </div>
            <div class="card-body p-0">
                @if (Model.Users.Any())
                {
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table mb-0">
                            <thead style="position: sticky; top: 0; background: var(--gray-50);">
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var user in Model.Users)
                                {
                                    var isNew = user.Status == "New" || user.Status == "Created";
                                    var isError = user.Status?.Contains("Error") ?? false;
                                    
                                    <tr>
                                        <td class="font-medium">@user.UserName</td>
                                        <td class="text-muted">@user.Email</td>
                                        <td>
                                            @if (isNew)
                                            {
                                                <span class="badge badge-success">New</span>
                                            }
                                            else if (isError)
                                            {
                                                <span class="badge badge-danger">Error</span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-gray">Existing</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <i class="bi bi-diagram-2 empty-state-icon"></i>
                        <h5 class="empty-state-title">No users found</h5>
                        <p class="empty-state-text">Configure LDAP connection to discover users.</p>
                        <a asp-action="Configure" class="btn btn-secondary">Configure LDAP</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
